*DECK DBKIAS
      SUBROUTINE DBKIAS (X, N, KTRMS, T, ANS, IND, MS, GMRN, H, IERR)
C***BEGIN PROLOGUE  DBKIAS
C***SUBSIDIARY
C***PURPOSE  Subsidiary to DBSKIN
C***LIBRARY   SLATEC
C***TYPE      REAL*8 (BKIAS-S, DBKIAS-D)
C***AUTHOR  Amos, D. E., (SNLA)
C***DESCRIPTION
C
C     DBKIAS computes repeated integrals of the K0 Bessel function
C     by the asymptotic expansion
C
C***SEE ALSO  DBSKIN
C***ROUTINES CALLED  D1MACH, DBDIFF, DGAMRN, DHKSEQ
C***REVISION HISTORY  (YYMMDD)
C   820601  DATE WRITTEN
C   890531  Changed all specific intrinsics to generic.  (WRB)
C   890911  Removed unnecessary intrinsics.  (WRB)
C   891214  Prologue converted to Version 4.0 format.  (BAB)
C   900328  Added TYPE section.  (WRB)
C   910722  Updated AUTHOR section.  (ALS)
C***END PROLOGUE  DBKIAS
      IMPLICIT NONE
      integer, parameter :: r8 = selected_real_kind(12,100)
      INTEGER I, II, IND, J, JMI, JN, K, KK, KM, KTRMS, MM, MP, MS, N,
     * IERR
      REAL*8 ANS, B, BND, DEN1, DEN2, DEN3, ER, ERR, FJ, FK,
     * FLN, FM1, GMRN, G1, GS, H, HN, HRTPI, RAT, RG1, RXP, RZ, RZX, S,
     * SS, SUMI, SUMJ, T, TOL, V, W, X, XP, Z
      REAL*8 DGAMRN, D1MACH
      DIMENSION B(120), XP(16), S(31), H(*), V(52), W(52), T(50),
     * BND(15)
      SAVE B, BND, HRTPI
C-----------------------------------------------------------------------
C             COEFFICIENTS OF POLYNOMIAL P(J-1,X), J=1,15
C-----------------------------------------------------------------------
      DATA B(1), B(2), B(3), B(4), B(5), B(6), B(7), B(8), B(9), B(10),
     * B(11), B(12), B(13), B(14), B(15), B(16), B(17), B(18), B(19),
     * B(20), B(21), B(22), B(23), B(24)
     *   /1.00000000000000000E00_r8,
     * 1.00000000000000000E00_r8,-2.00000000000000000E00_r8,
     * 1.00000000000000000E00_r8,-8.00000000000000000E00_r8,
     * 6.00000000000000000E00_r8,1.00000000000000000E00_r8,
     * -2.20000000000000000E01_r8,5.80000000000000000E01_r8,
     * -2.40000000000000000E01_r8,1.00000000000000000E00_r8,
     * -5.20000000000000000E01_r8,3.28000000000000000E02_r8,
     * -4.44000000000000000E02_r8,1.20000000000000000E02_r8,
     * 1.00000000000000000E00_r8,-1.14000000000000000E02_r8,
     * 1.45200000000000000E03_r8,-4.40000000000000000E03_r8,
     * 3.70800000000000000E03_r8,-7.20000000000000000E02_r8,
     * 1.00000000000000000E00_r8,-2.40000000000000000E02_r8,
     * 5.61000000000000000E03_r8/
      DATA B(25), B(26), B(27), B(28), B(29), B(30), B(31), B(32),
     * B(33), B(34), B(35), B(36), B(37), B(38), B(39), B(40), B(41),
     * B(42), B(43), B(44), B(45), B(46), B(47), B(48)
     * /-3.21200000000000000E04_r8,5.81400000000000000E04_r8,
     * -3.39840000000000000E04_r8,5.04000000000000000E03_r8,
     * 1.00000000000000000E00_r8,-4.94000000000000000E02_r8,
     * 1.99500000000000000E04_r8,-1.95800000000000000E05_r8,
     * 6.44020000000000000E05_r8,-7.85304000000000000E05_r8,
     * 3.41136000000000000E05_r8,-4.03200000000000000E04_r8,
     * 1.00000000000000000E00_r8,-1.00400000000000000E03_r8,
     * 6.72600000000000000E04_r8,-1.06250000000000000E06_r8,
     * 5.76550000000000000E06_r8,-1.24400640000000000E07_r8,
     * 1.10262960000000000E07_r8,-3.73392000000000000E06_r8,
     * 3.62880000000000000E05_r8,1.00000000000000000E00_r8,
     * -2.02600000000000000E03_r8,2.18848000000000000E05_r8/
      DATA B(49), B(50), B(51), B(52), B(53), B(54), B(55), B(56),
     * B(57), B(58), B(59), B(60), B(61), B(62), B(63), B(64), B(65),
     * B(66), B(67), B(68), B(69), B(70), B(71), B(72)
     * /-5.32616000000000000E06_r8,4.47650000000000000E07_r8,
     * -1.55357384000000000E08_r8,2.38904904000000000E08_r8,
     * -1.62186912000000000E08_r8,4.43390400000000000E07_r8,
     * -3.62880000000000000E06_r8,1.00000000000000000E00_r8,
     * -4.07200000000000000E03_r8,6.95038000000000000E05_r8,
     * -2.52439040000000000E07_r8,3.14369720000000000E08_r8,
     * -1.64838430400000000E09_r8,4.00269508800000000E09_r8,
     * -4.64216395200000000E09_r8,2.50748121600000000E09_r8,
     * -5.68356480000000000E08_r8,3.99168000000000000E07_r8,
     * 1.00000000000000000E00_r8,-8.16600000000000000E03_r8,
     * 2.17062600000000000E06_r8,-1.14876376000000000E08_r8,
     * 2.05148277600000000E09_r8,-1.55489607840000000E10_r8/
      DATA B(73), B(74), B(75), B(76), B(77), B(78), B(79), B(80),
     * B(81), B(82), B(83), B(84), B(85), B(86), B(87), B(88), B(89),
     * B(90), B(91), B(92), B(93), B(94), B(95), B(96)
     * /5.60413987840000000E10_r8,-1.01180433024000000E11_r8,
     * 9.21997902240000000E10_r8,-4.07883018240000000E10_r8,
     * 7.82771904000000000E09_r8,-4.79001600000000000E08_r8,
     * 1.00000000000000000E00_r8,-1.63560000000000000E04_r8,
     * 6.69969600000000000E06_r8,-5.07259276000000000E08_r8,
     * 1.26698177760000000E10_r8,-1.34323420224000000E11_r8,
     * 6.87720046384000000E11_r8,-1.81818864230400000E12_r8,
     * 2.54986547342400000E12_r8,-1.88307966182400000E12_r8,
     * 6.97929436800000000E11_r8,-1.15336085760000000E11_r8,
     * 6.22702080000000000E09_r8,1.00000000000000000E00_r8,
     * -3.27380000000000000E04_r8,2.05079880000000000E07_r8,
     * -2.18982980800000000E09_r8,7.50160522280000000E10_r8/
      DATA B(97), B(98), B(99), B(100), B(101), B(102), B(103), B(104),
     * B(105), B(106), B(107), B(108), B(109), B(110), B(111), B(112),
     * B(113), B(114), B(115), B(116), B(117), B(118)
     * /-1.08467651241600000E12_r8,7.63483214939200000E12_r8,
     * -2.82999100661120000E13_r8,5.74943734645920000E13_r8,
     * -6.47283751398720000E13_r8,3.96895780558080000E13_r8,
     * -1.25509040179200000E13_r8,1.81099255680000000E12_r8,
     * -8.71782912000000000E10_r8,1.00000000000000000E00_r8,
     * -6.55040000000000000E04_r8,6.24078900000000000E07_r8,
     * -9.29252692000000000E09_r8,4.29826006340000000E11_r8,
     * -8.30844432796800000E12_r8,7.83913848313120000E13_r8,
     * -3.94365587815520000E14_r8,1.11174747256968000E15_r8,
     * -1.79717122069056000E15_r8,1.66642448627145600E15_r8,
     * -8.65023253219584000E14_r8,2.36908271543040000E14_r8/
      DATA B(119), B(120) /-3.01963769856000000E13_r8,
     * 1.30767436800000000E12_r8/
C-----------------------------------------------------------------------
C             BOUNDS B(M,K) , K=M-3
C-----------------------------------------------------------------------
      DATA BND(1), BND(2), BND(3), BND(4), BND(5), BND(6), BND(7),
     * BND(8), BND(9), BND(10), BND(11), BND(12), BND(13), BND(14),
     * BND(15) /1.0_r8,1.0_r8,1.0_r8,
     *   1.0_r8,3.10_r8,5.18_r8,11.7_r8,
     *   29.8_r8,90.4_r8,297.0_r8,1070.0_r8,
     *   4290.0_r8,18100.0_r8,84700.0_r8,
     *   408000.0_r8/
      DATA HRTPI /8.86226925452758014E-01_r8/
C
C***FIRST EXECUTABLE STATEMENT  DBKIAS
      IERR=0
      TOL = MAX(D1MACH(4),1.0E-18_r8)
      FLN = N
      RZ = 1.0_r8/(X+FLN)
      RZX = X*RZ
      Z = 0.5_r8*(X+FLN)
      IF (IND.GT.1) GO TO 10
      GMRN = DGAMRN(Z)
   10 CONTINUE
      GS = HRTPI*GMRN
      G1 = GS + GS
      RG1 = 1.0_r8/G1
      GMRN = (RZ+RZ)/GMRN
      IF (IND.GT.1) GO TO 70
C-----------------------------------------------------------------------
C     EVALUATE ERROR FOR M=MS
C-----------------------------------------------------------------------
      HN = 0.5_r8*FLN
      DEN2 = KTRMS + KTRMS + N
      DEN3 = DEN2 - 2.0_r8
      DEN1 = X + DEN2
      ERR = RG1*(X+X)/(DEN1-1.0_r8)
      IF (N.EQ.0) GO TO 20
      RAT = 1.0_r8/(FLN*FLN)
   20 CONTINUE
      IF (KTRMS.EQ.0) GO TO 30
      FJ = KTRMS
      RAT = 0.25_r8/(HRTPI*DEN3*SQRT(FJ))
   30 CONTINUE
      ERR = ERR*RAT
      FJ = -3.0_r8
      DO 50 J=1,15
        IF (J.LE.5) ERR = ERR/DEN1
        FM1 = MAX(1.0_r8,FJ)
        FJ = FJ + 1.0_r8
        ER = BND(J)*ERR
        IF (KTRMS.EQ.0) GO TO 40
        ER = ER/FM1
        IF (ER.LT.TOL) GO TO 60
        IF (J.GE.5) ERR = ERR/DEN3
        GO TO 50
   40   CONTINUE
        ER = ER*(1.0_r8+HN/FM1)
        IF (ER.LT.TOL) GO TO 60
        IF (J.GE.5) ERR = ERR/FLN
   50 CONTINUE
      GO TO 200
   60 CONTINUE
      MS = J
   70 CONTINUE
      MM = MS + MS
      MP = MM + 1
C-----------------------------------------------------------------------
C     H(K)=(-Z)**(K)*(PSI(K-1,Z)-PSI(K-1,Z+0.5))/GAMMA(K) , K=1,2,...,MM
C-----------------------------------------------------------------------
      IF (IND.GT.1) GO TO 80
      CALL DHKSEQ(Z, MM, H, IERR)
      GO TO 100
   80 CONTINUE
      RAT = Z/(Z-0.5_r8)
      RXP = RAT
      DO 90 I=1,MM
        H(I) = RXP*(1.0_r8-H(I))
        RXP = RXP*RAT
   90 CONTINUE
  100 CONTINUE
C-----------------------------------------------------------------------
C     SCALED S SEQUENCE
C-----------------------------------------------------------------------
      S(1) = 1.0_r8
      FK = 1.0_r8
      DO 120 K=2,MP
        SS = 0.0_r8
        KM = K - 1
        I = KM
        DO 110 J=1,KM
          SS = SS + S(J)*H(I)
          I = I - 1
  110   CONTINUE
        S(K) = SS/FK
        FK = FK + 1.0_r8
  120 CONTINUE
C-----------------------------------------------------------------------
C     SCALED S-TILDA SEQUENCE
C-----------------------------------------------------------------------
      IF (KTRMS.EQ.0) GO TO 160
      FK = 0.0_r8
      SS = 0.0_r8
      RG1 = RG1/Z
      DO 130 K=1,KTRMS
        V(K) = Z/(Z+FK)
        W(K) = T(K)*V(K)
        SS = SS + W(K)
        FK = FK + 1.0_r8
  130 CONTINUE
      S(1) = S(1) - SS*RG1
      DO 150 I=2,MP
        SS = 0.0_r8
        DO 140 K=1,KTRMS
          W(K) = W(K)*V(K)
          SS = SS + W(K)
  140   CONTINUE
        S(I) = S(I) - SS*RG1
  150 CONTINUE
  160 CONTINUE
C-----------------------------------------------------------------------
C     SUM ON J
C-----------------------------------------------------------------------
      SUMJ = 0.0_r8
      JN = 1
      RXP = 1.0_r8
      XP(1) = 1.0_r8
      DO 190 J=1,MS
        JN = JN + J - 1
        XP(J+1) = XP(J)*RZX
        RXP = RXP*RZ
C-----------------------------------------------------------------------
C     SUM ON I
C-----------------------------------------------------------------------
        SUMI = 0.0_r8
        II = JN
        DO 180 I=1,J
          JMI = J - I + 1
          KK = J + I + 1
          DO 170 K=1,JMI
            V(K) = S(KK)*XP(K)
            KK = KK + 1
  170     CONTINUE
          CALL DBDIFF(JMI, V)
          SUMI = SUMI + B(II)*V(JMI)*XP(I+1)
          II = II + 1
  180   CONTINUE
        SUMJ = SUMJ + SUMI*RXP
  190 CONTINUE
      ANS = GS*(S(1)-SUMJ)
      RETURN
  200 CONTINUE
      IERR=2
      RETURN
      END
! 22Jun2000 fgtok -s r8_precision.sub "r8con.csh conversion"
! 22Jun2000 fgtok
! 22Jun2000 fgtok
