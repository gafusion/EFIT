#!/bin/bash
# Sanity check
if ! test -e @CMAKE_BINARY_DIR@/dprobe.dat; then
  echo "not running test because Greens tables were not found"
  exit 1
fi

# Remove output
if [ @HAVE_NETCDF@ = True ]; then
  outputs=( a g m )
else
  outputs=( a g )
fi
rm -f run_efit.out
for prefix in ${outputs[*]}; do
  for t in @TIMES@; do
    rm -f ${prefix}@RUNID@.${t}
  done
done

# Execute on server interactively (required on Iris?)
srun -p interactive --pty /bin/bash

# Now run efit
@EFIT_MPI_EXEC@ @GRID_SIZE@ << __c__MATCHING_EOF__c__ > run_efit.out

@EFIT_MODE@
@EFIT_TIME@
@EFIT_IN@

__c__MATCHING_EOF__c__

exit

# Pass the results of the efit command up so that CTest knows what happened
exit $?
